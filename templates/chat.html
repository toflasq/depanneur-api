<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>üêª Robot D√©panneur Christophe</title>
<style>
html, body { margin:0; height:100%; font-family:'Segoe UI', Tahoma, sans-serif; }
body.light { background:#40E0D0; }
body.dark { background:#505050; }

.chat-container { display:flex; flex-direction:column; height:100%; max-width:700px; margin:0 auto; padding:10px; box-sizing:border-box; }
h1 { text-align:center; font-family:'Smalley', sans-serif; font-size:1.8em; margin-bottom:10px; color:#fff; }
#themeToggle { position:absolute; top:10px; right:10px; padding:8px 12px; border:none; border-radius:12px; background:#007bff; color:#fff; cursor:pointer; font-size:0.9em; }

#chatbox { flex:1; padding:15px; border-radius:10px; overflow-y:auto; display:flex; flex-direction:column; gap:10px; transition: background 0.3s; }
body.light #chatbox { background:#b2f2bb; }
body.dark  #chatbox { background:#303030; }

.bubble { padding:10px 15px; border-radius:20px; max-width:75%; word-wrap:break-word; opacity:0; transform:translateY(10px); animation: fadeIn 0.3s forwards; transition: background 0.3s, color 0.3s; }
@keyframes fadeIn { to {opacity:1; transform:translateY(0);} }

.user { align-self:flex-end; background:#007bff; color:#fff; }
body.dark .user { background:#3399ff; color:#fff; }
.bot { align-self:flex-start; background:#f1f0f0; color:#333; }
body.dark .bot { background:#606060; color:#eee; }

.input-area { display:flex; gap:8px; margin-top:10px; }
.input-area input { flex:1; padding:12px; border-radius:25px; border:none; outline:none; transition: background 0.3s, color 0.3s; }
body.light .input-area input { background:#fff; color:#000; }
body.dark  .input-area input { background:#404040; color:#fff; }
.input-area button { padding:12px 20px; border:none; border-radius:25px; background:#007bff; color:#fff; cursor:pointer; }

.tools { display:flex; flex-wrap:wrap; gap:15px; padding:15px; }
.tool { flex:1; min-width:230px; background:#fff; border-radius:12px; padding:12px; box-shadow:0 3px 6px rgba(0,0,0,0.1); transition: background 0.3s, color 0.3s; }
body.dark .tool { background:#404040; color:#fff; }
.tool h3 { margin-top:0; font-size:1.1em; }
textarea { width:100%; height:120px; border-radius:8px; padding:8px; border:1px solid #ccc; font-size:0.95em; resize:vertical; }
input[type="number"], select { padding:6px; border-radius:6px; border:1px solid #ccc; margin:4px 0; width:100%; }
#result { margin-top:8px; font-weight:bold; }
.typing { font-style:italic; color:#555; }
body.dark .typing { color:#ccc; }
</style>
</head>
<body class="light">
<button id="themeToggle">üåô Sombre</button>

<div class="chat-container">
    <h1>üêª Robot D√©panneur Christophe</h1>
    <div id="chatbox"></div>
    <div class="input-area">
        <input type="text" id="message" placeholder="Tape ton message..." />
        <button onclick="sendMessage()">Envoyer</button>
    </div>
    <div class="tools">
        <!-- Bloc-notes -->
        <div class="tool">
            <h3>üìù Bloc-notes</h3>
            <textarea id="notes" placeholder="√âcris tes notes ici..."></textarea>
        </div>

        <!-- Convertisseur unit√©s -->
        <div class="tool">
            <h3>‚öñÔ∏è Convertisseur unit√©s</h3>
            <input type="number" id="value" placeholder="Valeur">
            <select id="unit">
                <option value="m_to_km">m ‚Üí km</option>
                <option value="km_to_m">km ‚Üí m</option>
                <option value="c_to_f">¬∞C ‚Üí ¬∞F</option>
                <option value="f_to_c">¬∞F ‚Üí ¬∞C</option>
                <option value="kg_to_lb">kg ‚Üí lb</option>
                <option value="lb_to_kg">lb ‚Üí kg</option>
            </select>
            <button onclick="convertUnit()">Convertir</button>
            <p id="result"></p>
        </div>
    </div>
</div>

<script>
const apiUrl="/chat";

// Th√®me
const themeBtn=document.getElementById('themeToggle');
themeBtn.addEventListener('click', ()=>{
    const body=document.body;
    if(body.classList.contains('light')){
        body.classList.replace('light','dark'); themeBtn.innerText="‚òÄÔ∏è Clair";
    } else {
        body.classList.replace('dark','light'); themeBtn.innerText="üåô Sombre";
    }
});

// Chat
async function sendMessage(){
    let msgInput=document.getElementById('message');
    let msg=msgInput.value.trim();
    if(msg==='') return;

    appendBubble(msg,'user');
    msgInput.value='';

    // Affiche "typing..."
    let typingBubble=appendBubble("‚Ä¶", 'bot', true);

    try{
        let response=await fetch(apiUrl,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({message:msg})
        });
        let data=await response.json();
        typingBubble.remove();
        appendBubble(data.answer,'bot');
    } catch(e){
        typingBubble.remove();
        appendBubble("‚ö†Ô∏è Erreur serveur",'bot');
    }
}

function appendBubble(text,type,isTyping=false){
    let chatbox=document.getElementById('chatbox');
    let div=document.createElement('div');
    div.className='bubble '+type + (isTyping ? " typing" : "");
    div.innerText=text;
    chatbox.appendChild(div);
    chatbox.scrollTop=chatbox.scrollHeight;
    return div;
}

// Convertisseur
function convertUnit(){
    let val=parseFloat(document.getElementById("value").value);
    let unit=document.getElementById("unit").value;
    let res;
    if(isNaN(val)){ document.getElementById("result").innerText="Entrer une valeur"; return; }
    switch(unit){
        case "m_to_km": res=val/1000+" km"; break;
        case "km_to_m": res=val*1000+" m"; break;
        case "c_to_f": res=(val*9/5+32).toFixed(2)+" ¬∞F"; break;
        case "f_to_c": res=((val-32)*5/9).toFixed(2)+" ¬∞C"; break;
        case "kg_to_lb": res=(val*2.20462).toFixed(2)+" lb"; break;
        case "lb_to_kg": res=(val/2.20462).toFixed(2)+" kg"; break;
    }
    document.getElementById("result").innerText="R√©sultat : "+res;
}

// Entr√©e = envoyer
document.getElementById('message').addEventListener('keypress',function(e){ if(e.key==='Enter') sendMessage(); });
</script>
</body>
</html>
